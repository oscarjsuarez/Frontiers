%Pinning Control for the p53-Mdm2 Network Dynamics Regulated by p14ARF
%Oscar J. Suarez, Carlos J. Vega, Edgar N Sanchez, Ana E González-Santiago, Otoniel Rodríguez-Jorge, Alma Y. Alanis, Guanrong Chen and Esteban A. Hernandez-Vargas
%Frontiers in Psychology
%Restoration of an oscillatory pattern under gamma-radiation

function [sys,x0] =DetModel_p53_MDM2_ConOscNature(t,x,~,flag)
tu=3600*24; % At t=24h, the control law is incepted 
%==========================================================================
%=================================Flag =1==================================
%==========================================================================        
if flag==1              % Equations for model
%==========================================================================
%============================PARAMETERS====================================
%==========================================================================   
kp  = 0.5;               % p53 Production
k1  = 1.9926*10^-6;      % MDM2 dependent p53 degradation
dp  = 3.85*10^-6;        % p53 Decay
km  = 1.5*10^-3;         % p53-Independent MDM2 production
k2  = 75*10^-3;          % p53-Dependent MDM2 production
kD  = 740;               % Dissociation constant
k0  = 8*10^-4;           % RNA transport from nucleus to cytoplasm
drc = 1.444*10^-4;       % MDM2 mRNA decay in cytoplasm
kT  = 1.66*10^-2;        % Transcription rate
ki  = 9*10^-4;           % Protein transport from cytoplasm to nucleus
dmm = 1.66*10^-7;        % MDM2 autoubiquitination
ka  = 0.5;               % ARF production
da  = 3.209*10^-5;       % ARF decay
k3  = 9.963*10^-6;       % MDM2-ARF complex formation rate
%==========================================================================
%=========================DYNAMICAL MODEL==================================
%========================================================================== 
[Ref1,Ref2,Ref3] =Reference_Signal(t,tu);
[u1,u2,u3] =Controller(t,tu,x(1),x(2),x(6),Ref1,Ref2,Ref3,x(7));
dxdt = zeros(6,1);
dxdt(1) = kp*u1 - k1*(1-u3)*x(1)*x(5) - dp*x(1);
dxdt(2) = km*u2 + (k2*x(1)^1.8/(kD^1.8+x(1)^1.8)) - k0*x(2);
dxdt(3) = k0*x(2) - drc*x(3);
dxdt(4) = kT*x(3) - ki*x(4);
dxdt(5) = ki*x(4) - dmm*x(5)^2 -k3*x(5)*x(6);
dxdt(6) = ka - da*x(6) - k3*x(5)*x(6);
dxdt(7)   = -100*x(7)  + 25^3;
sys = dxdt;
%==========================================================================        
%==========================================================================
%=================================Flag =3==================================
%==========================================================================        
%==========================================================================
elseif flag==3               % Outputs
[Ref1,Ref2,Ref3] =Reference_Signal(t,tu);
[u1,u2,u3] =Controller(t,tu,x(1),x(2),x(6),Ref1,Ref2,Ref3,x(7));
sys = [x(1:6);Ref1;Ref2;Ref3;u1;u2;u3];
%==========================================================================        
%==========================================================================
%=================================Flag =0==================================
%==========================================================================        
%==========================================================================
elseif flag==0              % Initial Conditions 
       n  = 7;
       p  = 12; 
       m  = 0;
       % 'p' Outputs Number, 'm' Input Number y 'n' State Number
       sys=[n, 0, p, m, 0, 0];
       x0=[90;70;0;0;0;100;0];
end
end
function [u1,u2,u3] =Controller(t,tu,x1,x2,x6,ref1,ref2,ref3,Sd)
    if t<tu
        u1=1;
        u2=1;
        u3=1;
    else
        e1=(x1-ref1);
        e2=(x2-ref2);
        e3=(x6-ref3);
        u1=1+0*(1-sign(e1));
        u2=1+0*(1-sign(e2));        
        sphi3=e3/ Sd;
        if abs(sphi3)< 1 
            u3    =  1+(5)*(1-(e3));         
        else
            u3    =  1+(5)*(1-sign(e3));       
        end
        if u3 > 11 
            u3    =  11;       
        end     
     end       
end
function [Ref1,Ref2,Ref3] =Reference_Signal(x,tu)
     if x >= tu
        K = 2 ;
     else
         K= 0 ;
     end
%==========================================================================        
%==========================================================================
%========================Ref 1=============================================
%==========================================================================        
%==========================================================================
    if   K == 2
%==========================================================================
       a0 =       350.5;  
       a1 =      -303.1;  
       b1 =         209;  
       a2 =       48.23;  
       b2 =      -82.87;  
       w =    0.0002707;   
        Ref1 = a0 + a1*cos(x*w) + b1*sin(x*w) + ... 
               a2*cos(2*x*w) + b2*sin(2*x*w);
      else
        Ref1=0;
      end 
%==========================================================================        
%==========================================================================
%========================Ref for x6========================================
%==========================================================================        
%==========================================================================    
   if   K == 2
%==========================================================================
%========================Ref Oscillations==================================
%==========================================================================  
      a0 =       345.3*4; 
       a1 =      -297.6*4; 
       b1 =       204.2*4; 
       a2 =          47*4; 
       b2 =      -79.98*4; 
       a3 =      -8.159*4; 
       b3 =       3.148*4; 
       w  =   0.0002707;   
       Ref3 =   a0 + a1*cos(x*w) + b1*sin(x*w) + ...
               a2*cos(2*x*w) + b2*sin(2*x*w) + a3*cos(3*x*w) + b3*sin(3*x*w);
    else
        Ref3=0;
   end 
%==========================================================================        
%==========================================================================
%========================Ref for x2========================================
%==========================================================================        
%==========================================================================    
   if   K == 2
%==========================================================================
%========================Ref Oscillations==================================
%==========================================================================  
       a0 =        5.72;  
       a1 =      -4.592;  
       b1 =      0.6678;  
       a2 =       1.147;  
       b2 =     -0.1822;  
       a3 =    -0.08746;  
       b3 =     -0.1092; 
       w =    0.0002713;     
       Ref2 = a0 + a1*cos(x*w) + b1*sin(x*w) + ...
               a2*cos(2*x*w) + b2*sin(2*x*w) + a3*cos(3*x*w) + b3*sin(3*x*w);  
    else
        Ref2=0;
    end 
end