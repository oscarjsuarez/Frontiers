%Pinning Control for the p53-Mdm2 Network Dynamics Regulated by p14ARF
%Oscar J. Suarez, Carlos J. Vega, Edgar N Sanchez, Ana E González-Santiago, Otoniel Rodríguez-Jorge, Alma Y. Alanis, Guanrong Chen and Esteban A. Hernandez-Vargas
%Frontiers in Psychology
%Achievement of a p53 level increased expression

function [sys,x0] =DetModel_p53_MDM2_ConApoNature(t,x,~,flag)

tu=3600*24; % At t=24h, the control law is incepted 
%==========================================================================
%=================================Flag =1==================================
%==========================================================================        
if flag==1              % Equations for model
%==========================================================================
%============================PARAMETERS====================================
%==========================================================================   
kp  = 0.5;               % p53 Production
k1  = 1.9926*10^-6;      % MDM2 dependent p53 degradation
dp  = 3.85*10^-6;        % p53 Decay
km  = 1.5*10^-3;         % p53-Independent MDM2 production
k2  = 75*10^-3;          % p53-Dependent MDM2 production
kD  = 740;               % Dissociation constant
k0  = 8*10^-4;           % RNA transport from nucleus to cytoplasm
drc = 1.444*10^-4;       % MDM2 mRNA decay in cytoplasm
kT  = 1.66*10^-2;        % Transcription rate
ki  = 9*10^-4;           % Protein transport from cytoplasm to nucleus
dmm = 1.66*10^-7;        % MDM2 autoubiquitination
ka  = 0.5;               % ARF production
da  = 3.209*10^-5;       % ARF decay
k3  = 9.963*10^-6;       % MDM2-ARF complex formation rate
%==========================================================================
%=========================DYNAMICAL MODEL==================================
%========================================================================== 
[Ref1,Ref2,Ref3] =Reference_Signal(t,tu);
[u1,u2,u3] =Controller(t,tu,x(1),x(2),x(6),Ref1,Ref2,Ref3,x(7));
dxdt = zeros(6,1);
dxdt(1) = kp*u1 - k1*x(1)*x(5) - dp*x(1);
dxdt(2) = km*u2 + (k2*x(1)^1.8/(kD^1.8+x(1)^1.8)) - k0*x(2);
dxdt(3) = k0*x(2) - drc*x(3);
dxdt(4) = kT*x(3) - ki*x(4);
dxdt(5) = ki*x(4) - dmm*x(5)^2 -k3*x(5)*x(6);
dxdt(6) = ka*u3 - da*x(6) - k3*x(5)*x(6);
dxdt(7)   = -100*x(7)  + 25^3;
sys = dxdt;
%==========================================================================
%=================================Flag =3==================================
%==========================================================================        
elseif flag==3               % Outputs
[Ref1,Ref2,Ref3] =Reference_Signal(t,tu);
[u1,u2,u3] =Controller(t,tu,x(1),x(2),x(6),Ref1,Ref2,Ref3,x(7));
sys = [x(1:6);Ref1;Ref2;Ref3;u1;u2;u3];
%==========================================================================
%=================================Flag =0==================================
%==========================================================================        
elseif flag==0              % Initial Conditions 
       n  = 7;
       p  = 12; 
       m  = 0;
       % 'p' Outputs Number, 'm' Input Number y 'n' State Number
       sys=[n, 0, p, m, 0, 0];
       x0=[90;70;0;0;0;100;0];
end
end
function [u1,u2,u3] =Controller(t,tu,x1,x2,x6,ref1,ref2,ref3,Sd)
    if t<tu
        u1=1;
        u2=1;
        u3=1;
    else
        e1=(x1-ref1);
        e2=(x2-ref2);
        e3=(x6-ref3);
       u1=1+0*(1-sign(e1));
       u2=1+0*(1-sign(e2));
       sphi3=e3/ Sd;
        if abs(sphi3)< 1 
            u3    =  1+(100)*(1-(e3));         
        else
            u3    =  1+(100)*(1-sign(e3));      
        end
        if u3 < 1 
            u3    =  1;       
        end
    end       
end
function [Ref1,Ref2,Ref3] =Reference_Signal(x,tu)
     if x >= tu
        K = 2 ;
     else
         K= 0 ;
     end
%==========================================================================
%========================Ref 1=============================================
%==========================================================================        
    if   K == 2
%==========================================================================
       a =   2.582e+04;  
       b =  -2.823e-09;  
       c =  -2.586e+04;  
       d =  -3.861e-05;   
       Ref1 = a*exp(b*(x-tu)) + c*exp(d*(x-tu));            
    else
       Ref1=0;
    end 
%==========================================================================        
%==========================================================================
%========================Ref for x6========================================
%==========================================================================        
%==========================================================================    
   if   K == 2
%==========================================================================
%========================Ref Apoptosis==================================
%==========================================================================  
       a =   1.552e+05;  
       b =   7.466e-11;  
       c =  -1.558e+05;  
       d =  -6.419e-05;   
       Ref3 =  a*exp(b*(x-tu)) + c*exp(d*(x-tu));
       else
       Ref3=0;
   end 
%==========================================================================        
%==========================================================================
%========================Ref for x2========================================
%==========================================================================        
%==========================================================================    
   if   K == 2
%==========================================================================
%========================Ref Apoptosis==================================
%==========================================================================  
       a =       20.54;  
       b =   2.065e-08;  
       c =      -23.69;  
       d =  -0.0006551;  
       Ref2 = a*exp(b*(x-tu)) + c*exp(d*(x-tu));  
    else
       Ref2=0;
    end 
 end